<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Slap Game</title>
  <style>
    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{
      overflow:hidden;
      font-family:system-ui,Segoe UI,sans-serif;
      -webkit-user-select:none; user-select:none;
      -webkit-tap-highlight-color:transparent;
      background:#000;
    }

    /* Fullscreen background audio (mp4) - hidden video */
    video#bgAudio{
      position:fixed;
      width:1px;height:1px;opacity:0;pointer-events:none;
    }

    /* Fullscreen poster image area (edge-to-edge) */
    .poster{
      position:fixed; inset:0;
      background:#000;
    }

    /* Character image fills the screen */
    .poster img{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;        /* full screen cover */
      object-position:center;  /* center crop */
      transform:translateZ(0);
    }

    /* readability tint so text is visible */
    .tint{
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.05) 35%, rgba(0,0,0,.55));
      pointer-events:none;
    }

    /* HUD overlay top */
    .hudTop{
      position:absolute;
      top:calc(10px + env(safe-area-inset-top));
      left:12px;
      right:12px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:center;
      pointer-events:none; /* allow taps through */
    }

    .hudBox{
      flex:1;
      background:rgba(255,255,255,.92);
      border-radius:14px;
      padding:10px 10px;
      text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      color:#111;
    }
    .hudBox .k{font-size:12px;font-weight:900;opacity:.75}
    .hudBox .v{font-size:22px;font-weight:1000;margin-top:2px}
    .hudBox.time .v{color:#ff5f6d}
    .hudBox.score .v{color:#e0a100}
    .hudBox.best .v{color:#23b26b}

    .playerTag{
      position:absolute;
      top:calc(86px + env(safe-area-inset-top));
      left:50%;
      transform:translateX(-50%);
      background:rgba(255,255,255,.92);
      color:#111;
      padding:10px 14px;
      border-radius:14px;
      font-weight:1000;
      box-shadow:0 10px 30px rgba(0,0,0,.22);
      pointer-events:none;
      white-space:nowrap;
    }
    .playerTag span{color:#ff2f8d}

    /* Title pop-up on slap */
    .titlePop{
      position:absolute;
      left:50%;
      top:calc(140px + env(safe-area-inset-top));
      transform:translate(-50%, 0);
      background:rgba(0,0,0,.62);
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      font-weight:1000;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 14px 40px rgba(0,0,0,.35);
      opacity:0;
      pointer-events:none;
      transition:opacity .12s ease, transform .12s ease;
      text-align:center;
      max-width:92vw;
    }
    .titlePop.show{
      opacity:1;
      transform:translate(-50%, -6px);
    }

    /* Bottom buttons overlay */
    .bottomBar{
      position:absolute;
      left:12px; right:12px;
      bottom:calc(12px + env(safe-area-inset-bottom));
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
    }
    .btn{
      flex:1;
      padding:12px 12px;
      border:none;
      border-radius:14px;
      font-weight:1000;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
      cursor:pointer;
    }
    .btn.start{background:rgba(255,255,255,.92); color:#111}
    .btn.restart{background:#ff2f8d; color:#fff}
    .btn.leader{background:rgba(255,255,255,.92); color:#111}
    .btn:active{transform:translateY(1px)}

    /* Tap hint */
    .hint{
      position:absolute;
      left:50%;
      bottom:calc(72px + env(safe-area-inset-bottom));
      transform:translateX(-50%);
      background:rgba(0,0,0,.45);
      color:rgba(255,255,255,.9);
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      border:1px solid rgba(255,255,255,.14);
      pointer-events:none;
      white-space:nowrap;
    }

    /* Slap feedback */
    .flash{
      position:absolute; inset:0;
      background:rgba(255,0,0,.18);
      opacity:0;
      pointer-events:none;
      transition:opacity .06s linear;
    }

    .shake{ animation:shake .16s linear 1; }
    @keyframes shake{
      0%{transform:translate(0)}
      25%{transform:translate(4px,-3px)}
      50%{transform:translate(-4px,3px)}
      75%{transform:translate(3px,3px)}
      100%{transform:translate(0)}
    }

    /* Result overlay */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
      padding:14px;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(420px, 94vw);
      background:rgba(255,255,255,.95);
      color:#111;
      border-radius:18px;
      padding:18px;
      text-align:center;
      box-shadow:0 26px 80px rgba(0,0,0,.45);
    }
    .modal h2{margin:0 0 8px}
    .modal .big{font-size:34px;font-weight:1000;color:#ff2f8d}
    .modal .row{display:flex; gap:10px; margin-top:12px}
    .modal .row button{flex:1}

    /* Prevent scroll bounce on mobile */
    .noScroll{touch-action:none}
  </style>
</head>

<body class="noScroll">

  <!-- Hidden video only for background audio -->
  <video id="bgAudio" src="https://files.catbox.moe/r77wx8.mp4" loop playsinline preload="auto"></video>

  <div class="poster" id="poster">
    <!-- character image -->
    <img id="charImg" alt="character" />
    <div class="tint"></div>
    <div class="flash" id="flash"></div>

    <!-- HUD -->
    <div class="hudTop">
      <div class="hudBox time">
        <div class="k">‡¶∏‡¶Æ‡ßü</div>
        <div class="v" id="time">01:00</div>
      </div>
      <div class="hudBox score">
        <div class="k">‡¶•‡¶æ‡¶™‡ßç‡¶™‡ßú</div>
        <div class="v" id="score">0</div>
      </div>
      <div class="hudBox best">
        <div class="k">‡¶∏‡ßá‡¶∞‡¶æ</div>
        <div class="v" id="best">0</div>
      </div>
    </div>

    <div class="playerTag">‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú: <span id="playerName">Washiq</span></div>

    <!-- Title pop -->
    <div class="titlePop" id="titlePop">‡¶Æ‡¶æ‡¶¶‡¶ï ‡¶∏‡¶Æ‡ßç‡¶∞‡¶æ‡¶ü ‡¶Ü‡¶¨‡ßç‡¶¨‡¶æ‡¶∏</div>

    <div class="hint">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßá ‡¶•‡¶æ‡¶™‡ßç‡¶™‡ßú ‡¶¶‡¶ø‡¶® üëÜ</div>

    <!-- Buttons -->
    <div class="bottomBar">
      <button class="btn start" id="btnStart">‚ñ∂ ‡¶∂‡ßÅ‡¶∞‡ßÅ</button>
      <button class="btn restart" id="btnRestart">‚Ü∫ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü</button>
      <button class="btn leader" id="btnLeader">üèÜ ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
    </div>
  </div>

  <!-- Result -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2>‚è∞ ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑!</h2>
      <div class="big" id="finalScore">0</div>
      <div style="font-weight:900">Best: <span id="finalBest">0</span></div>
      <div class="row">
        <button class="btn restart" id="btnPlayAgain">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßá‡¶≤‡ßÅ‡¶®</button>
        <button class="btn start" id="btnClose">‡¶¨‡¶®‡ßç‡¶ß</button>
      </div>
    </div>
  </div>

<script>
  // Character images
  const IDLE_IMG = "https://files.catbox.moe/n5tdgb.jpg"; // ‡¶•‡¶æ‡¶™‡ßç‡¶™‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞
  const SLAP_IMG = "https://files.catbox.moe/jdabf7.jpg"; // ‡¶•‡¶æ‡¶™‡ßç‡¶™‡¶∞ ‡¶ñ‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞

  const imgIdle = new Image();
  const imgSlap = new Image();
  imgIdle.src = IDLE_IMG;
  imgSlap.src = SLAP_IMG;

  // Elements
  const bgAudio = document.getElementById("bgAudio");

  const poster = document.getElementById("poster");
  const charImg = document.getElementById("charImg");
  const flash = document.getElementById("flash");

  const timeEl = document.getElementById("time");
  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");

  const playerNameEl = document.getElementById("playerName");
  const titlePop = document.getElementById("titlePop");

  const btnStart = document.getElementById("btnStart");
  const btnRestart = document.getElementById("btnRestart");
  const btnLeader = document.getElementById("btnLeader");

  const overlay = document.getElementById("overlay");
  const finalScoreEl = document.getElementById("finalScore");
  const finalBestEl = document.getElementById("finalBest");
  const btnPlayAgain = document.getElementById("btnPlayAgain");
  const btnClose = document.getElementById("btnClose");

  // State
  let running = false;
  let timerId = null;
  let timeLeft = 60;
  let score = 0;
  let slapTimeout = null;
  let titleTimeout = null;

  // Player name (later you can add form)
  if (!localStorage.getItem("playerName")) localStorage.setItem("playerName", "Washiq");
  playerNameEl.textContent = localStorage.getItem("playerName") || "Player";

  // Best
  bestEl.textContent = String(Number(localStorage.getItem("bestSlap") || "0"));

  // Init character image
  charImg.src = imgIdle.src;

  // Title list (‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¨‡¶≤‡ßá‡¶õ‡ßã)
  const titles = [
    "‡¶¨‡ßã‡¶∞‡¶ï‡¶æ ‡¶Ü‡¶¨‡ßç‡¶¨‡¶æ‡¶∏",
    "‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶Æ‡¶æ ‡¶Æ‡¶ø‡¶∞‡ßç‡¶ú‡¶æ ‡¶Ü‡¶¨‡ßç‡¶¨‡¶æ‡¶∏",
    "‡¶Æ‡¶æ‡¶¶‡¶ï ‡¶∏‡¶Æ‡ßç‡¶∞‡¶æ‡¶ü ‡¶Ü‡¶¨‡ßç‡¶¨‡¶æ‡¶∏",
    "‡¶ó‡ßç‡¶Ø‡¶æ‡¶Ç‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶¨‡ßç‡¶¨‡¶æ‡¶∏‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶®",
    "‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ‡¶¨‡¶æ‡¶ú ‡¶Ü‡¶¨‡ßç‡¶¨‡¶æ‡¶∏"
  ];

  function formatTime(sec){
    const m = Math.floor(sec/60);
    const s = sec%60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  async function goFullscreen(){
    try{
      const el = document.documentElement;
      if (!document.fullscreenElement && el.requestFullscreen) await el.requestFullscreen();
    }catch(e){}
  }

  async function playAudio(){
    // must be triggered by user gesture (Start/Restart)
    try{
      bgAudio.muted = false;
      bgAudio.volume = 1;
      await bgAudio.play();
    }catch(e){
      console.log("audio blocked:", e);
    }
  }

  function startGame(){
    running = true;
    score = 0;
    timeLeft = 60;
    scoreEl.textContent = "0";
    timeEl.textContent = formatTime(timeLeft);
    charImg.src = imgIdle.src;
    overlay.classList.remove("show");

    clearInterval(timerId);
    timerId = setInterval(()=>{
      timeLeft--;
      timeEl.textContent = formatTime(Math.max(0,timeLeft));
      if (timeLeft <= 0) endGame();
    }, 1000);
  }

  function endGame(){
    running = false;
    clearInterval(timerId);

    const best = Math.max(score, Number(localStorage.getItem("bestSlap") || "0"));
    localStorage.setItem("bestSlap", String(best));
    bestEl.textContent = String(best);

    finalScoreEl.textContent = String(score);
    finalBestEl.textContent = String(best);
    overlay.classList.add("show");
  }

  function showRandomTitle(){
    // ‚úÖ ‡¶∏‡¶Æ‡ßü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ variation:
    // ‡¶∂‡ßá‡¶∑ 15 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá titles ‡¶Ü‡¶∞‡¶ì aggressive/random ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
    const pick = titles[Math.floor(Math.random() * titles.length)];
    titlePop.textContent = pick;

    titlePop.classList.add("show");
    clearTimeout(titleTimeout);
    titleTimeout = setTimeout(()=> titlePop.classList.remove("show"), 650);
  }

  function feedback(){
    flash.style.opacity = "1";
    setTimeout(()=> flash.style.opacity = "0", 60);

    poster.classList.remove("shake");
    void poster.offsetWidth;
    poster.classList.add("shake");
  }

  function slap(){
    if (!running) return;

    score++;
    scoreEl.textContent = String(score);

    feedback();
    showRandomTitle();

    // image swap idle->slap->idle
    charImg.src = imgSlap.src;
    clearTimeout(slapTimeout);
    slapTimeout = setTimeout(()=>{ charImg.src = imgIdle.src; }, 130);
  }

  // Tap anywhere on poster = slap
  poster.addEventListener("pointerdown", (e)=>{
    // ignore taps on buttons when not running? (still ok)
    // but make sure buttons still click: if target is a button, return
    if (e.target && e.target.tagName === "BUTTON") return;
    e.preventDefault();
    slap();
  }, {passive:false});

  // Buttons
  btnStart.addEventListener("click", async ()=>{
    await goFullscreen();
    await playAudio();
    startGame();
  });

  btnRestart.addEventListener("click", async ()=>{
    await goFullscreen();
    await playAudio();
    startGame();
  });

  btnPlayAgain.addEventListener("click", async ()=>{
    overlay.classList.remove("show");
    await goFullscreen();
    await playAudio();
    startGame();
  });

  btnClose.addEventListener("click", ()=> overlay.classList.remove("show"));

  btnLeader.addEventListener("click", ()=>{
    alert("Leaderboard: ‡¶°‡ßá‡¶Æ‡ßã‡¶§‡ßá ‡¶è‡¶ñ‡¶® Best (local) ‡¶Ü‡¶õ‡ßá‡•§ ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶ø Firebase leaderboard ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡•§");
  });

  // keep audio alive when returning
  document.addEventListener("visibilitychange", async ()=>{
    if (!document.hidden && running){
      try{ await bgAudio.play(); }catch(e){}
    }
  });

  // Initial time text
  timeEl.textContent = formatTime(60);
</script>
</body>
        </html>
