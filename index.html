<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Slap Game</title>
  <style>
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,Segoe UI,sans-serif;
      overflow:hidden;
      -webkit-user-select:none; user-select:none;
      -webkit-tap-highlight-color:transparent;
      background:#000;
    }

    /* Background video cover (optional visual) */
    .bgVideo{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-3;
      filter:brightness(.85) saturate(1.1);
    }
    /* Pop-art overlay feel (so it looks like lagarelaga) */
    .popOverlay{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(900px 520px at 50% 10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(800px 420px at 20% 40%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(135deg, rgba(255,0,128,.20), rgba(255,196,0,.18));
      mix-blend-mode: screen;
      pointer-events:none;
    }
    /* Dark readability tint */
    .tint{
      position:fixed; inset:0; z-index:-1;
      background:rgba(0,0,0,.18);
      pointer-events:none;
    }

    /* Layout: header / main / footer bar */
    .wrap{
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* HUD */
    .hudRow{
      padding:10px 12px 6px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .hudBox{
      flex:1;
      background:rgba(255,255,255,.92);
      color:#111;
      border-radius:14px;
      padding:10px 10px;
      text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .hudBox .k{font-size:12px; opacity:.75; font-weight:800}
    .hudBox .v{font-size:22px; font-weight:1000; margin-top:2px}
    .hudBox.time .v{color:#ff5f6d}
    .hudBox.score .v{color:#e0a100}
    .hudBox.best .v{color:#23b26b}

    .playerPill{
      margin:0 12px 10px;
      background:rgba(255,255,255,.92);
      border-radius:14px;
      padding:10px 12px;
      text-align:center;
      font-weight:900;
      color:#111;
      box-shadow:0 10px 30px rgba(0,0,0,.22);
    }
    .playerPill span{color:#ff2f8d}

    /* Main character area */
    .stage{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px 8px 0;
    }
    .character{
      width:min(86vw, 520px);
      aspect-ratio: 3 / 4;
      border-radius:22px;
      overflow:hidden;
      box-shadow:0 26px 80px rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
      transform:translateZ(0);
      touch-action:none;
    }
    .character img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }

    .flash{
      position:absolute;
      inset:0;
      background:rgba(255,0,0,.20);
      opacity:0;
      pointer-events:none;
      transition:opacity .06s linear;
    }
    .shake{ animation:shake .16s linear 1; }
    @keyframes shake{
      0%{transform:translate(0)}
      25%{transform:translate(4px,-3px)}
      50%{transform:translate(-4px,3px)}
      75%{transform:translate(3px,3px)}
      100%{transform:translate(0)}
    }

    /* Bottom control bar like lagarelaga */
    .bottomBar{
      padding:10px 12px;
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
    }
    .btn{
      flex:1;
      padding:12px 12px;
      border:none;
      border-radius:14px;
      font-weight:1000;
      cursor:pointer;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
      color:#111;
      background:rgba(255,255,255,.92);
    }
    .btn.primary{
      background:#ff2f8d;
      color:#fff;
    }
    .btn.secondary{
      background:rgba(255,255,255,.92);
      color:#111;
    }
    .btn:active{transform:translateY(1px)}

    /* Overlay result */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
      padding:14px;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(420px, 94vw);
      background:rgba(255,255,255,.95);
      color:#111;
      border-radius:18px;
      padding:18px;
      text-align:center;
      box-shadow:0 26px 80px rgba(0,0,0,.45);
    }
    .modal h2{margin:0 0 8px}
    .modal p{margin:8px 0 12px; font-weight:800}
    .modal .big{font-size:34px; font-weight:1000; color:#ff2f8d}
    .modal .row{display:flex; gap:10px}
    .modal .row button{flex:1}

    /* Tiny sound badge */
    .soundBadge{
      position:fixed;
      right:12px;
      bottom:calc(76px + env(safe-area-inset-bottom));
      background:rgba(255,255,255,.92);
      color:#111;
      padding:8px 10px;
      border-radius:999px;
      font-weight:900;
      border:none;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
    }
  </style>
</head>
<body>

  <!-- Background video used as background + audio -->
  <video
    id="bgVideo"
    class="bgVideo"
    src="https://files.catbox.moe/r77wx8.mp4"
    loop
    playsinline
    preload="auto"
  ></video>
  <div class="popOverlay"></div>
  <div class="tint"></div>

  <div class="wrap">
    <!-- HUD -->
    <div>
      <div class="hudRow">
        <div class="hudBox time">
          <div class="k">‡¶∏‡¶Æ‡ßü</div>
          <div class="v" id="time">01:00</div>
        </div>
        <div class="hudBox score">
          <div class="k">‡¶•‡¶æ‡¶™‡ßç‡¶™‡ßú</div>
          <div class="v" id="score">0</div>
        </div>
        <div class="hudBox best">
          <div class="k">‡¶∏‡ßá‡¶∞‡¶æ</div>
          <div class="v" id="best">0</div>
        </div>
      </div>
      <div class="playerPill">‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú: <span id="playerName">Washiq</span></div>
    </div>

    <!-- Main stage -->
    <div class="stage">
      <div class="flash" id="flash"></div>
      <div class="character" id="tapArea" aria-label="Tap area">
        <img id="charImg" alt="character" />
      </div>
    </div>

    <!-- Bottom bar -->
    <div class="bottomBar">
      <button class="btn secondary" id="btnStart">‚ñ∂ ‡¶∂‡ßÅ‡¶∞‡ßÅ</button>
      <button class="btn primary" id="btnRestart">‚Ü∫ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü</button>
      <button class="btn secondary" id="btnLeader">üèÜ ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
    </div>
  </div>

  <!-- Sound toggle -->
  <button class="soundBadge" id="btnSound">üîä Sound On</button>

  <!-- Result overlay -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2>‚è∞ ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑!</h2>
      <div class="big" id="finalScore">0</div>
      <p>Best: <span id="finalBest">0</span></p>
      <div class="row">
        <button class="btn primary" id="btnPlayAgain">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßá‡¶≤‡ßÅ‡¶®</button>
        <button class="btn secondary" id="btnClose">‡¶¨‡¶®‡ßç‡¶ß</button>
      </div>
    </div>
  </div>

<script>
  // Images
  const IDLE_IMG = "https://files.catbox.moe/n5tdgb.jpg";
  const SLAP_IMG = "https://files.catbox.moe/jdabf7.jpg";

  const imgIdle = new Image();
  const imgSlap = new Image();
  imgIdle.src = IDLE_IMG;
  imgSlap.src = SLAP_IMG;

  // Elements
  const bgVideo = document.getElementById("bgVideo");
  const timeEl = document.getElementById("time");
  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");
  const playerNameEl = document.getElementById("playerName");

  const tapArea = document.getElementById("tapArea");
  const charImg = document.getElementById("charImg");
  const flash = document.getElementById("flash");

  const btnStart = document.getElementById("btnStart");
  const btnRestart = document.getElementById("btnRestart");
  const btnLeader = document.getElementById("btnLeader");
  const btnSound = document.getElementById("btnSound");

  const overlay = document.getElementById("overlay");
  const finalScoreEl = document.getElementById("finalScore");
  const finalBestEl = document.getElementById("finalBest");
  const btnPlayAgain = document.getElementById("btnPlayAgain");
  const btnClose = document.getElementById("btnClose");

  // State
  let muted = false;
  let running = false;
  let timerId = null;
  let timeLeft = 60;
  let score = 0;
  let slapTimeout = null;

  // Init
  charImg.src = imgIdle.src;
  const savedBest = Number(localStorage.getItem("bestSlap") || "0");
  bestEl.textContent = savedBest;

  // (Optional) player name from prompt once
  // You can replace with your form later
  if (!localStorage.getItem("playerName")){
    localStorage.setItem("playerName", "Washiq");
  }
  playerNameEl.textContent = localStorage.getItem("playerName") || "Player";

  function formatTime(sec){
    const m = Math.floor(sec/60);
    const s = sec%60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  async function ensureAudio(){
    try{
      bgVideo.muted = muted;
      bgVideo.volume = muted ? 0 : 1;
      await bgVideo.play();
    }catch(e){
      // autoplay blocked until user interaction (Start button provides interaction)
      console.log("play blocked", e);
    }
  }

  async function goFullscreen(){
    // best-effort fullscreen on user gesture
    try{
      const el = document.documentElement;
      if (!document.fullscreenElement && el.requestFullscreen) {
        await el.requestFullscreen();
      }
    }catch(e){}
  }

  function startGame(){
    running = true;
    score = 0;
    timeLeft = 60;

    scoreEl.textContent = "0";
    timeEl.textContent = formatTime(timeLeft);
    charImg.src = imgIdle.src;
    overlay.classList.remove("show");

    clearInterval(timerId);
    timerId = setInterval(()=>{
      timeLeft--;
      timeEl.textContent = formatTime(Math.max(0, timeLeft));
      if (timeLeft <= 0){
        endGame();
      }
    }, 1000);
  }

  function endGame(){
    running = false;
    clearInterval(timerId);

    const best = Math.max(score, Number(localStorage.getItem("bestSlap") || "0"));
    localStorage.setItem("bestSlap", String(best));
    bestEl.textContent = String(best);

    finalScoreEl.textContent = String(score);
    finalBestEl.textContent = String(best);
    overlay.classList.add("show");
  }

  function feedback(){
    flash.style.opacity = "1";
    setTimeout(()=> flash.style.opacity = "0", 60);

    tapArea.classList.remove("shake");
    void tapArea.offsetWidth;
    tapArea.classList.add("shake");
  }

  function slap(){
    if (!running) return;
    score++;
    scoreEl.textContent = String(score);

    feedback();

    charImg.src = imgSlap.src;
    clearTimeout(slapTimeout);
    slapTimeout = setTimeout(()=>{
      charImg.src = imgIdle.src;
    }, 130);
  }

  // Tap control
  tapArea.addEventListener("pointerdown", (e)=>{
    e.preventDefault();
    slap();
  }, {passive:false});

  // Buttons
  btnStart.addEventListener("click", async ()=>{
    await goFullscreen();
    await ensureAudio();
    startGame();
  });

  btnRestart.addEventListener("click", async ()=>{
    await goFullscreen();
    await ensureAudio();
    startGame();
  });

  btnPlayAgain.addEventListener("click", async ()=>{
    overlay.classList.remove("show");
    await goFullscreen();
    await ensureAudio();
    startGame();
  });

  btnClose.addEventListener("click", ()=> overlay.classList.remove("show"));

  btnSound.addEventListener("click", async ()=>{
    muted = !muted;
    btnSound.textContent = muted ? "üîá Sound Off" : "üîä Sound On";
    bgVideo.muted = muted;
    bgVideo.volume = muted ? 0 : 1;
    if (!muted) await ensureAudio();
  });

  // Leaderboard placeholder (you can connect backend later)
  btnLeader.addEventListener("click", ()=>{
    alert("Leaderboard: ‡¶è‡¶ñ‡¶® ‡¶°‡ßá‡¶Æ‡ßã‡¶§‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ Best (local) ‡¶Ü‡¶õ‡ßá‡•§ ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶ø Firebase ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡•§");
  });

  // Keep audio alive when returning
  document.addEventListener("visibilitychange", async ()=>{
    if (!document.hidden && running && !muted) await ensureAudio();
  });

  // Initial time
  timeEl.textContent = formatTime(60);
</script>
</body>
  </html>
